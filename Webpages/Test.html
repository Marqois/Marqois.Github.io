<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code MP3 Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #qr-video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #333;
            margin-bottom: 20px;
        }
        #qr-reader-results {
            font-size: 1.2em;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>QR Code MP3 Player</h1>
    <video id="qr-video"></video>
    <div id="qr-reader-results">Scan a QR code with an MP3 link to play audio.</div>

    <!-- Load QR Scanner library -->
    <script type="module">
        import QrScanner from "https://unpkg.com/qr-scanner/qr-scanner.min.js";

        let player; // Audio player instance
        let playbackTimer;
        const playbackDuration = 30; // Duration to play audio in seconds

        document.addEventListener('DOMContentLoaded', function () {
            const video = document.getElementById('qr-video');
            const resultContainer = document.getElementById("qr-reader-results");

            // Initialize QR scanner
            const qrScanner = new QrScanner(video, result => {
                console.log('Decoded QR code:', result);
                handleScannedLink(result.data);
            }, { 
                highlightScanRegion: true,
                highlightCodeOutline: true,
            });
            qrScanner.start(); // Start scanning

            // Handle the scanned QR code data
            function handleScannedLink(data) {
                if (data.endsWith(".mp3")) {  // Check if the scanned link is an MP3 file
                    playAudio(data);
                    resultContainer.textContent = "Playing audio from: " + data;
                } else {
                    resultContainer.textContent = "Scanned link is not an MP3 file.";
                    console.log("The scanned link is not an MP3 file.");
                }
            }

            // Play audio from the scanned URL
            function playAudio(url) {
                // Stop any existing playback
                if (player) {
                    player.pause();
                    player.currentTime = 0;
                }

                // Initialize new audio player with the provided URL
                player = new Audio(url);
                player.play();
                player.addEventListener('ended', () => console.log('Playback ended.'));

                // Optional: Stop playback after specified duration
                playbackTimer = setTimeout(() => {
                    player.pause();
                    player.currentTime = 0;
                    resultContainer.textContent = "Playback stopped after " + playbackDuration + " seconds.";
                }, playbackDuration * 1000);
            }
        });
    </script>
</body>
</html>